---
// posts.astro (or src/pages/blog/index.astro)
export const prerender = false;

import Layout from "../../layouts/Layout.astro";
import { fetchPosts } from "../../lib/directus";
// If your component is .jsx, change the import accordingly:
import BlogCard from "../../components/BlogCard.jsx";

const posts = await fetchPosts();

// Soft CDN caching on Vercel (fast + fresh)
Astro.response.headers.set("Cache-Control", "s-maxage=60, stale-while-revalidate=300");
---

<Layout title="Blog | misavoid.dev">
    <div class="max-w-7xl mx-auto p-6 space-y-12 w-full">
        <h1 class="text-3xl font-bold text-center">Gedankenfuerze</h1>

        {posts.length === 0 ? (
                <p class="opacity-50 text-center">No posts yet.</p>
        ) : (
            // Use a DIV grid (not <ul>) so the BlogCard can be the grid child
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                {posts.map((p, idx) => (
                        <BlogCard
                                client:load
                    title={p.title}
                    date={p.published_at ?? null}

                    summary={p.summary ?? undefined}

                    content={p.content ?? undefined}
                    className={idx === posts.length - 1 && posts.length % 2 === 1
                ? "md:col-span-2 md:mx-auto"
                : ""}
                    />
                    ))}
                </div>
        )}
    </div>
</Layout>
