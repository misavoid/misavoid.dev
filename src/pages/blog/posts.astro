---
export const prerender = false; // SSR so new posts appear instantly

import Layout from '../../layouts/Layout.astro';
import { fetchPosts } from '../../lib/directus';

const posts = await fetchPosts();

// Soft CDN caching on Vercel (fast + fresh)
Astro.response.headers.set('Cache-Control', 's-maxage=60, stale-while-revalidate=300');
---

<Layout title="Blog | misavoid.dev">
    <div class="max-w-7xl mx-auto p-6 space-y-12 w-full">
        <!-- Centered title -->
        <h1 class="text-3xl font-bold text-center">Gedankenfuerze</h1>

        {posts.length === 0 ? (
                <p class="opacity-50 text-center">No posts yet.</p>
        ) : (
                <ul class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    {posts.map((p) => (
                            <li
                                    class="rounded-2xl p-6 bg-gradient-to-br from-fuchsia-600/70 to-violet-600/70 text-white
             shadow-lg hover:shadow-xl transition transform hover:-translate-y-1
             border-4 border-black"
                            >
                                <a
                                        href={`/blog/${p.slug}`}
                                        class="text-xl font-semibold hover:underline"
                                >
                                    {p.title}
                                </a>
                                <div class="text-sm opacity-90 mt-2">
                                    {p.published_at
                                        ? new Date(p.published_at).toLocaleDateString()
                                        : ''}
                                    {p.tags && p.tags.length ? ` Â· ${p.tags.join(', ')}` : ''}
                                </div>
                            </li>
                    ))}
                </ul>
        )}
    </div>
</Layout>
