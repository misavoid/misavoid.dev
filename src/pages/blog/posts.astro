---
// posts.astro (or src/pages/blog/index.astro)
export const prerender = false;

import Layout from "../../layouts/Layout.astro";
import { fetchPosts } from "../../lib/directus";
// If your component is .jsx, change the import accordingly:
import BlogCard from "../../components/BlogCard.jsx";

const posts = await fetchPosts();

// Generate a set of random fluffy lobes for the title cloud to feel organic.
// This randomizes per server render; if you want a stable layout, we can seed this.
const FLUFF_COUNT = 18;
const fcFluff = Array.from({ length: FLUFF_COUNT }).map((_, i) => {
  const w = 70 + Math.random() * 120; // 70..190 px
  const h = w * (0.65 + Math.random() * 0.5); // 0.65..1.15 aspect
  const left = 18 + Math.random() * 64; // 18%..82%
  const top = 32 + Math.random() * 36; // 32%..68%
  const dx = (Math.random() < 0.5 ? -1 : 1) * (4 + Math.random() * 6);
  const dy = (Math.random() < 0.5 ? -1 : 1) * (3 + Math.random() * 6);
  const t = 6 + Math.random() * 2.5; // 6..8.5s
  const delay = -Math.random() * 1.8; // negative for staggered start
  return { id: `fluff-${i}-${Math.random().toString(36).slice(2,7)}`, w, h, left, top, dx, dy, t, delay };
});

// Soft CDN caching on Vercel (fast + fresh)
Astro.response.headers.set("Cache-Control", "s-maxage=60, stale-while-revalidate=300");
---

<Layout title="Blog | misavoid.dev">
    <div class="max-w-7xl mx-auto p-6 space-y-12 w-full">
        <div class="flex justify-center mt-14 md:mt-20 mb-14 md:mb-20">
            <div class="fc-cloud">
                <span class="fc-bubble fc-b1" aria-hidden="true"></span>
                <span class="fc-bubble fc-b2" aria-hidden="true"></span>
                <span class="fc-bubble fc-b3" aria-hidden="true"></span>
                <span class="fc-bubble fc-b4" aria-hidden="true"></span>
                <span class="fc-bubble fc-b5" aria-hidden="true"></span>
                <span class="fc-bubble fc-b6" aria-hidden="true"></span>
                <span class="fc-bubble fc-b7" aria-hidden="true"></span>
                <span class="fc-bubble fc-b8" aria-hidden="true"></span>
                {fcFluff.map(f => (
                  <span class="fc-fluff" aria-hidden style={`--t:${f.t}s; --dx:${f.dx}px; --dy:${f.dy}px; left:${f.left}%; top:${f.top}%; width:${f.w}px; height:${f.h}px; animation-delay:${f.delay}s;`}></span>
                ))}
                <!-- central lobes for extra volume -->
                <span class="fc-core fc-c1" aria-hidden="true"></span>
                <span class="fc-core fc-c2" aria-hidden="true"></span>
                <span class="fc-core fc-c3" aria-hidden="true"></span>
                <span class="fc-core fc-c4" aria-hidden="true"></span>
                <span class="fc-halo" aria-hidden="true"></span>
                <span class="fc-shadow" aria-hidden="true"></span>
                <h1 class="fc-text relative z-[2] text-4xl md:text-6xl font-extrabold tracking-wide text-gray-900 select-none">
                    Gedankenfuerze.
                </h1>
            </div>
        </div>

        {posts.length === 0 ? (
                <p class="opacity-50 text-center">No posts yet.</p>
        ) : (
            // Use a DIV grid (not <ul>) so the BlogCard can be the grid child
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 md:gap-x-16 gap-y-16 md:gap-y-24">
                {posts.map((p, idx) => (
                        <BlogCard
                            client:load
                            title={p.title}
                            date={p.published_at ?? null}
                            summary={p.summary ?? undefined}
                            content={p.content ?? undefined}
                            slug={p.slug}
                            prevSlug={posts[idx + 1]?.slug}
                            nextSlug={posts[idx - 1]?.slug}
                            postsData={posts.map(x => ({
                                slug: x.slug,
                                title: x.title,
                                summary: x.summary ?? undefined,
                                content: x.content ?? undefined,
                                published_at: x.published_at ?? null,
                            }))}
                            className={idx === posts.length - 1 && posts.length % 2 === 1
                                ? "md:col-span-2 md:mx-auto"
                                : ""}
                        />
                    ))}
                </div>
        )}
    </div>
</Layout>
<style is:inline>
/* fun 3D-ish animated cloud for the blog title (more volume) */
.fc-cloud {
  position: relative;
  padding: 1.25rem 2.25rem;
  border-radius: 9999px;
  background:
    radial-gradient(160px 120px at 25% 40%, rgba(255,255,255,0.98), rgba(255,255,255,0.8) 74%, transparent 84%),
    radial-gradient(200px 140px at 75% 35%, rgba(255,255,255,0.98), rgba(255,255,255,0.8) 74%, transparent 84%),
    radial-gradient(340px 220px at 50% 58%, rgba(255,255,255,0.99), rgba(255,255,255,0.85) 74%, transparent 86%),
    linear-gradient( to bottom, rgba(255,255,255,0.96), rgba(246,252,246,0.92) );
  box-shadow:
    0 36px 80px rgba(0,0,0,0.14),
    0 16px 30px rgba(0,0,0,0.08),
    inset 0 4px 16px rgba(255,255,255,0.8);
  transform-style: preserve-3d;
  animation: fc-float 6.5s ease-in-out infinite;
}
.fc-cloud::before {
  content: "";
  position: absolute;
  inset: -6px;
  border-radius: 9999px;
  background: radial-gradient(circle at 65% 35%, rgba(255,255,255,0.85), transparent 60%);
  filter: blur(10px);
  z-index: 0;
}
.fc-halo {
  position: absolute;
  inset: -14px;
  border-radius: 9999px;
  background: radial-gradient(ellipse at 50% 120%, rgba(200,255,200,0.5), transparent 62%), radial-gradient(ellipse at 50% -20%, rgba(255,255,255,0.35), transparent 55%);
  filter: blur(22px);
  z-index: 1;
}
.fc-shadow {
  position: absolute;
  left: 6%; right: 6%; bottom: -18px; height: 22px;
  border-radius: 9999px;
  background: radial-gradient(60% 100% at 50% 0%, rgba(0,0,0,0.16), transparent 70%);
  filter: blur(6px);
  transform: translateZ(-1px);
}
.fc-core {
  position: absolute;
  z-index: 1;
  border-radius: 9999px;
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.98), rgba(248,252,248,0.9));
  box-shadow: 0 16px 36px rgba(0,0,0,0.08);
}
.fc-c1 { width: 220px; height: 150px; left: 50%; top: 52%; transform: translate(-52%, -52%); }
.fc-c2 { width: 170px; height: 125px; left: 59%; top: 49%; transform: translate(-50%, -50%); }
.fc-c3 { width: 150px; height: 115px; left: 43%; top: 56%; transform: translate(-50%, -50%); }
.fc-c4 { width: 130px; height: 105px; left: 50%; top: 62%; transform: translate(-50%, -50%); }
.fc-bubble {
  position: absolute;
  border-radius: 9999px;
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.98), rgba(245,250,245,0.85));
  box-shadow: 0 14px 30px rgba(0,0,0,0.08);
  filter: saturate(1.05);
  animation: fc-drift var(--t,7s) ease-in-out infinite;
  will-change: transform;
}
.fc-fluff {
  position: absolute;
  z-index: 1;
  border-radius: 9999px;
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.98), rgba(248,252,248,0.88));
  box-shadow: 0 12px 26px rgba(0,0,0,0.06);
  animation: fc-drift var(--t, 7s) ease-in-out infinite;
}
.fc-b1 { width: 128px; height: 98px; left: -34px; top: -20px; --t: 7.5s; animation-delay: -1.2s; }
.fc-b2 { width: 108px; height: 86px; right: -30px; top: -14px; --t: 6.8s; animation-delay: -0.6s; }
.fc-b3 { width: 160px; height: 120px; left: 36%; bottom: -34px; --t: 7.2s; animation-delay: -2.1s; }
.fc-b4 { width: 96px; height: 76px; right: 28%; bottom: -28px; --t: 6.2s; animation-delay: -1.7s; }
.fc-b5 { width: 84px; height: 70px; left: 10%; top: -18px; --t: 6.6s; animation-delay: -0.9s; }
.fc-b6 { width: 72px; height: 60px; right: 12%; top: -12px; --t: 6.4s; animation-delay: -0.4s; }
.fc-b7 { width: 92px; height: 74px; left: 8%; bottom: -24px; --t: 7.8s; animation-delay: -1.5s; }
.fc-b8 { width: 78px; height: 62px; right: 8%; bottom: -20px; --t: 6.9s; animation-delay: -1.0s; }

/* flip vertically via constant scaleY(-1) baked into animation */
@keyframes fc-float {
  0%,100% { transform: scaleY(-1) translateY(0) rotateX(0deg) rotateZ(0deg); }
  50% { transform: scaleY(-1) translateY(-8px) rotateX(2.5deg) rotateZ(0.6deg); }
}
@keyframes fc-drift {
  0%,100% { transform: translate3d(0,0,0) scale(1); }
  50% { transform: translate3d(var(--dx, 6px), var(--dy, -4px), 0) scale(1.035); }
}
/* slight per-bubble directionality */
.fc-b1 { --dx: 8px; --dy: -5px; }
.fc-b2 { --dx: -7px; --dy: -3px; }
.fc-b3 { --dx: 5px; --dy: 6px; }
.fc-b4 { --dx: -6px; --dy: 5px; }
.fc-b5 { --dx: 6px; --dy: -4px; }
.fc-b6 { --dx: -6px; --dy: -3px; }
.fc-b7 { --dx: 5px; --dy: 4px; }
.fc-b8 { --dx: -5px; --dy: 4px; }

/* unflip the text so it reads normally */
.fc-text { transform: scaleY(-1); display: inline-block; }
</style>
