---
export const prerender = false; // SSR so new posts appear instantly

import Layout from '../layouts/Layout.astro';
import { fetchPosts } from '../lib/directus';

const posts = await fetchPosts();

// Soft CDN caching on Vercel (fast + fresh)
Astro.response.headers.set('Cache-Control', 's-maxage=60, stale-while-revalidate=300');
---

<Layout title="Blog | misavoid.dev">
    <main class="max-w-3xl mx-auto p-6 space-y-6">
        <h1 class="text-3xl font-bold">Research & OSINT</h1>
        {posts.length === 0 ? (
                <p class="opacity-70">No posts yet.</p>
        ) : (
                <ul class="space-y-4">
                    {posts.map((p) => (
                            <li class="border rounded-2xl p-4 hover:shadow transition">
                                <a href={`/blog/${p.slug}`} class="text-xl font-medium hover:underline">
                                    {p.title}
                                </a>
                                <div class="text-sm opacity-70">
                                    {p.published_at ? new Date(p.published_at).toLocaleDateString() : ''}
                                    {p.tags && p.tags.length ? ` Â· ${p.tags.join(', ')}` : ''}
                                </div>
                            </li>
                    ))}
                </ul>
        )}
    </main>
</Layout>
